# .github/workflows/pull-request.yml
name: ğŸ” Pull Request Validation

on:
  pull_request:
    branches: [ main, develop ]
    types: [opened, synchronize, reopened]

jobs:
  # ===== ÙØ­Øµ Ø³Ø±ÙŠØ¹ Ù„Ù„Ù€ PR =====
  pr-check:
    name: ğŸ¯ Quick PR Validation
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout PR Branch
      uses: actions/checkout@v4
      with:
        fetch-depth: 0
        
    - name: ğŸš€ Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        
    - name: ğŸ“¦ Install Dependencies
      run: npm ci
      
    - name: ğŸ“ Check File Sizes
      run: |
        echo "ğŸ“Š Checking large files..."
        find . -name "*.tsx" -o -name "*.ts" | xargs wc -l | sort -nr | head -10
        
        # ØªØ­Ø°ÙŠØ± Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…Ù„Ù page.tsx ÙƒØ¨ÙŠØ± Ø¬Ø¯Ø§Ù‹
        if [ -f "src/app/admin/bookings/page.tsx" ]; then
          PAGE_LINES=$(wc -l < src/app/admin/bookings/page.tsx)
          if [ $PAGE_LINES -gt 2000 ]; then
            echo "âš ï¸ Warning: page.tsx is too large ($PAGE_LINES lines)"
            echo "ğŸ’¡ Consider splitting into smaller components"
          fi
        fi
        
    - name: ğŸ” TypeScript Validation
      run: npx tsc --noEmit
      
    - name: ğŸ—ï¸ Build Test
      run: npm run build
      
    - name: ğŸ“ PR Summary
      run: |
        echo "âœ… PR Validation Summary:"
        echo "ğŸ“ Files changed: $(git diff --name-only origin/main...HEAD | wc -l)"
        echo "â• Lines added: $(git diff --stat origin/main...HEAD | tail -1)"

  # ===== ÙØ­Øµ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯ =====
  code-review:
    name: ğŸ” Automated Code Review
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout Code
      uses: actions/checkout@v4
      with:
        fetch-depth: 0
        
    - name: ğŸ” Check for Console Logs
      run: |
        echo "ğŸ” Checking for console.log statements..."
        if git diff origin/main...HEAD | grep -E '^\+.*console\.(log|warn|error)'; then
          echo "âš ï¸ Found console statements in new code"
          echo "ğŸ’¡ Consider removing them before merge"
        else
          echo "âœ… No console statements found"
        fi
        
    - name: ğŸ“± Mobile-First Check
      run: |
        echo "ğŸ“± Checking for mobile-first design..."
        if git diff origin/main...HEAD | grep -E 'sm:|md:|lg:'; then
          echo "âœ… Responsive design classes found"
        else
          echo "ğŸ’¡ Consider adding responsive design"
        fi
